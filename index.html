<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Currency input</title>
    <style>
        .container {
            margin: 48px;
        }
    </style>
</head>
<body>
    <div class="container">
        <form action="">
            <input type="text" id="currencyInput">
        </form>
    </div>
</body>
</html>
<script>
    var originalValue = '';
    var lastValue = '';
    var el = document.getElementById("currencyInput");
    // el.addEventListener("keydown", onChange, false);
    // el.addEventListener("keyup", onDelete, false);
    el.addEventListener('input', test);
    function onChange (event) {
    let { key } = event;
    let { value } = event.target;
    if (key.length == 1) {
        event.preventDefault();
    }
    if (key.match(/[a-z!@#$%^&*(),.?":{}|<>]/) == null) {
        let maskedValue = value;
        if (key == 0 && originalValue != '' && originalValue == 0) {
        return;
        } 
        if (originalValue.length < 11) {
        originalValue += key;
        maskedValue = getMaskedValue(originalValue);
        }
        event.target.value = maskedValue;
    }
    }

    function getMaskedValue (original) {
        return getMillions(original)
        + getThousands(original)
        + getHundreds(original)
        + getCents(original); 
    }

    function getCents(value) {
    if (value.length == 1) {
        return `0${value}`;
    }
    if (value.length >= 2) {
        return value.slice(value.length-2, value.length);
    }

    return '00';
    }

    function getHundreds(value) {
    let hundreds = separator(2, 5, value);
    return hundreds ? `${hundreds},` : '0,';
    }

    function getThousands(value) {
    let thousands = separator(5, 8, value);
    return thousands ? `${thousands}.` : thousands;
    }
    
    function getMillions(value) {
    let millions = separator(8, 11, value);
    return millions ? `${millions}.` : millions;
    }

    function separator(start, end, value) {
    if (value.length > start) {
        if (value.length <= end) {
        return value.slice(0, value.length - start);
        }
        if (value.length > end) {
        return value.slice(value.length - end, value.length - start);
        }
    }

    return '';
    }

    function removeMask(value) {
    value = value.replace(/[^0-9]+/g, '');
    return value ? parseInt(value).toString() : '';
    }

    function onDelete(event) {
    let { key } = event;
    let { value } = event.target;
    if (key == 'Backspace' || key == 'Delete') {
        if (value != '' && value != '0' && value != '0,0' & value != '0,00') {
        originalValue = removeMask(value);      
        } else {
        originalValue = '';
        }
        let maskedValue = originalValue ? getMaskedValue(originalValue) : '';
        event.target.value = maskedValue;
    }
    }

    function test (e) {
    const value = e.target.value;
    let newValue = removeMask(value);
    if (newValue.length > 11) {
        e.target.value = lastValue;
        return;
    }
    newValue = getMaskedValue(newValue);
    if (value == '0,0'&& newValue == '0,00' && lastValue == '0,00') {
        lastValue = e.target.value = '';
        return;
    }
    lastValue = e.target.value = newValue;
    }
        
</script>